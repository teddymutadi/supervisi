<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Supervisi Akademik</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .form-card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); padding: 2rem; margin-bottom: 2rem; }
        .instrument-item { border-bottom: 1px solid #e2e8f0; padding: 1.5rem 0; }
        .instrument-item:last-child { border-bottom: none; }
        .radio-group { display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem; }
        .radio-option { display: flex; align-items: flex-start; gap: 0.75rem; cursor: pointer; transition: all 0.2s; padding: 0.5rem; border-radius: 8px; }
        .radio-option:hover { background-color: #f1f5f9; }
        .custom-radio { margin-top: 0.25rem; width: 1.25rem; height: 1.25rem; border: 2px solid #cbd5e1; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        input[type="radio"]:checked + .custom-radio { border-color: #3b82f6; background-color: #3b82f6; box-shadow: inset 0 0 0 4px white; }
        .chart-bar-container { position: relative; height: 40px; background: #f1f5f9; border-radius: 20px; display: flex; align-items: center; margin: 10px 0; }
        .chart-line { height: 4px; background: #3b82f6; border-radius: 2px; }
        .chart-circle { width: 32px; height: 32px; background: #3b82f6; border: 4px solid white; border-radius: 50%; position: absolute; transform: translateX(-50%); display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .form-card { box-shadow: none; border: none; padding: 0; }
            .page-break { page-break-before: always; }
        }
        #result-area { display: none; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-10 no-print">
            <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight mb-2 uppercase">Aplikasi Supervisi Akademik</h1>
            <p class="text-slate-500">Instrumen Pemantauan dan Evaluasi Pembelajaran Modern</p>
        </div>

        <div id="input-form">
            <!-- Identity Section -->
            <div class="form-card">
                <h2 class="text-xl font-bold mb-6 text-slate-800 border-b pb-2 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    Informasi Umum
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Tanggal Supervisi</label>
                        <input type="date" id="tgl_supervisi" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" onchange="updateDay()">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Hari</label>
                        <input type="text" id="hari" readonly class="w-full px-4 py-2 border rounded-lg bg-slate-50 outline-none" placeholder="Otomatis">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Nama Guru</label>
                        <input type="text" id="nama_guru" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Masukkan nama guru">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Mata Pelajaran</label>
                        <input type="text" id="mapel" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Masukkan mata pelajaran">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Madrasah</label>
                        <input type="text" id="madrasah" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Nama madrasah">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Alamat Madrasah</label>
                        <input type="text" id="alamat_madrasah" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Alamat lengkap">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Nama Supervisor</label>
                        <input type="text" id="nama_supervisor" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Nama lengkap supervisor">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-1">Instansi Supervisor</label>
                        <input type="text" id="instansi_supervisor" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="Asal instansi">
                    </div>
                </div>
            </div>

            <!-- Instrument Section -->
            <div class="form-card">
                <h2 class="text-xl font-bold mb-6 text-slate-800 border-b pb-2 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                    Instrumen Supervisi
                </h2>
                <div id="instruments-container">
                    <!-- Javascript will inject items here -->
                </div>
            </div>

            <!-- Recommendation -->
            <div class="form-card">
                <h2 class="text-xl font-bold mb-4 text-slate-800 border-b pb-2">Rekomendasi</h2>
                <textarea id="rekomendasi" class="w-full border rounded-lg p-4 focus:ring-2 focus:ring-blue-500 outline-none transition" style="height: 3cm;" placeholder="Tuliskan rekomendasi hasil supervisi di sini..."></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-wrap gap-4 mb-10 no-print">
                <button onclick="generateResult()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl transition shadow-lg shadow-blue-200 flex items-center justify-center gap-2">
                    HASIL SUPERVISI
                </button>
            </div>
        </div>

        <!-- Result Display Area -->
        <div id="result-area">
            <div id="printable-content" class="bg-white p-8 md:p-12 border rounded-xl shadow-sm">
                <div class="text-center border-b-4 border-double border-slate-800 pb-4 mb-6">
                    <h2 class="text-2xl font-bold uppercase tracking-widest">Laporan Hasil Supervisi Akademik</h2>
                    <p id="res-madrasah" class="text-lg font-semibold mt-2"></p>
                    <p id="res-alamat" class="text-sm"></p>
                </div>

                <div class="grid grid-cols-2 gap-y-2 text-sm mb-8 border p-4 rounded-lg bg-slate-50">
                    <div><span class="font-bold w-40 inline-block">Nama Guru</span>: <span id="res-nama-guru"></span></div>
                    <div><span class="font-bold w-40 inline-block">Mata Pelajaran</span>: <span id="res-mapel"></span></div>
                    <div><span class="font-bold w-40 inline-block">Hari / Tanggal</span>: <span id="res-waktu"></span></div>
                    <div><span class="font-bold w-40 inline-block">Supervisor</span>: <span id="res-supervisor"></span></div>
                </div>

                <h3 class="text-lg font-bold mb-4 border-b-2 border-slate-200 pb-1">Visualisasi Skor Aspek</h3>
                <div id="chart-display" class="mb-10 space-y-4">
                    <!-- Chart rows injected here -->
                </div>

                <div class="mb-10">
                    <h3 class="text-lg font-bold mb-2 border-b-2 border-slate-200 pb-1">Rekomendasi</h3>
                    <div id="res-rekomendasi" class="p-4 bg-slate-50 rounded border min-h-[3cm]"></div>
                </div>

                <!-- Signature Section -->
                <div class="mt-16 grid grid-cols-2 gap-20 text-center">
                    <div>
                        <p class="mb-20">Guru yang Disupervisi,</p>
                        <p class="font-bold underline" id="sig-guru"></p>
                    </div>
                    <div>
                        <p class="mb-20">Supervisor,</p>
                        <p class="font-bold underline" id="sig-supervisor"></p>
                    </div>
                </div>
            </div>

            <!-- Print/Download buttons -->
            <div class="flex gap-4 mt-8 no-print pb-20">
                <button id="btn-word" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition flex items-center justify-center gap-2">
                    UNDUH WORD
                </button>
                <button id="btn-print" class="flex-1 bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 px-6 rounded-lg transition flex items-center justify-center gap-2">
                    CETAK PDF
                </button>
                <button id="btn-back" class="flex-1 bg-slate-400 hover:bg-slate-500 text-white font-bold py-3 px-6 rounded-lg transition">
                    KEMBALI KE FORM
                </button>
            </div>
        </div>
    </div>

    <script>
        const instruments = [
            {
                id: 'A',
                title: 'A. Asesmen Awal',
                options: [
                    { skor: 1, text: 'Guru tidak tidak mengajukan pertanyaan untuk mengetahui kemampuan awal murid' },
                    { skor: 2, text: 'Guru mengajukan pertanyaan untuk mengetahui kemampuan awal murid terkait dengan materi yang akan diajarkan' },
                    { skor: 3, text: 'Guru mengajukan pertanyaan untuk mengetahui kemampuan awal murid terkait dengan materi yang akan diajarkan namun tidak mengecek gaya belajar dan minat murid' },
                    { skor: 4, text: 'Guru mengajukan pertanyaan untuk mengetahui kemampuan awal murid terkait dengan materi yang akan diajarkan dan mengecek gaya belajar dan minat murid' }
                ]
            },
            {
                id: 'B',
                title: 'B. Tujuan Pembelajaran',
                options: [
                    { skor: 1, text: 'Guru tidak mengerti kalau TP diturunkan dari CP' },
                    { skor: 2, text: 'Guru mengerti kalau TP diturunkan dari CP' },
                    { skor: 3, text: 'Guru mengerti kalau TP diturunkan dari CP tapi tidak mengerti formulasi TP terdiri dari kompetensi dan kontent' },
                    { skor: 4, text: 'Guru mengerti kalau TP diturunkan dari CP dan mengerti juga formulasi TP terdiri dari kompetensi dan kontent' }
                ]
            },
            {
                id: 'C',
                title: 'C. Indikator Keberhasilan',
                options: [
                    { skor: 1, text: 'Guru tidak menyusun indikator keberhasilan' },
                    { skor: 2, text: 'Guru menyusun indikator keberhasilan tidak sesuai kompetensi' },
                    { skor: 3, text: 'Guru menyusun indikator keberhasian tidak sesuai konten' },
                    { skor: 4, text: 'Guru menyusun indikator keberhasilan komprehensif, kompetensi sesuai, dan konten sesuai' }
                ]
            },
            {
                id: 'D',
                title: 'D. Pembelajaran Mendalam',
                options: [
                    { skor: 1, text: 'Guru tidak menentukan Dimensi Profil Lulusan' },
                    { skor: 2, text: 'Guru menentukan Dimensi Profil Lulusan namun tidak relevan dengan Tujuan Pembelajaran' },
                    { skor: 3, text: 'Guru menentukan Dimensi Profil Lulusan yang relevan dengan Tujuan Pembelajaran' },
                    { skor: 4, text: 'Guru menentukan Dimensi Profil Lulusan yang relevan dengan Tujuan Pembelajaran dan menunjukkan evidence atau kegiatan yang terkait' }
                ]
            },
            {
                id: 'E',
                title: 'E. Menginsersikan Kurikulum Berbasis Cinta',
                options: [
                    { skor: 1, text: 'Guru tidak menentukan topik Panca Cinta' },
                    { skor: 2, text: 'Guru menentukan topik Panca Cinta namun tidak relevan dengan Tujuan Pembelajaran' },
                    { skor: 3, text: 'Guru menentukan topik Panca Cinta yang relevan dengan Tujuan Pembelajaran' },
                    { skor: 4, text: 'Guru menentukan topik Panca Cinta yang relevan dengan Tujuan Pembelajaran dan sekaligus materi kurikulumnya di Dirjen Pendis 6077' }
                ]
            },
            {
                id: 'F',
                title: 'F. Praktik Pedagogik',
                options: [
                    { skor: 1, text: 'Guru tidak menentukan model, strategi, metode pembelajaran' },
                    { skor: 2, text: 'Guru menentukan model, strategi, metode pembelajaran lama' },
                    { skor: 3, text: 'Guru menentukan model, strategi, metode pembelajaran yang baru' },
                    { skor: 4, text: 'Guru melakukan fusi model, strategi, metode pembelajaran yang lama dan baru' }
                ]
            },
            {
                id: 'G',
                title: 'G. Lingkungan Pembelajaran',
                options: [
                    { skor: 1, text: 'Guru menggunakan lingkungan fisik' },
                    { skor: 2, text: 'Guru menggunakan lingkungan fisik dan virtual' },
                    { skor: 3, text: 'Guru menggunakan lingkungan fisik, virtual, dan budaya belajar' },
                    { skor: 4, text: 'Guru menggunakan lingkungan fisik, virtual, budaya belajar, dan hubungan' }
                ]
            },
            {
                id: 'H',
                title: 'H. Kemitraan Pembelajaran',
                options: [
                    { skor: 1, text: 'Guru tidak bermitra dengan murid dalam pembelajaran' },
                    { skor: 2, text: 'Guru bermitra dengan murid, orang tua dalam pembelajaran' },
                    { skor: 3, text: 'Guru bermitra dengan murid, guru bermitra dengan orang tua, murid bermitra dengan murid dalam pembelajaran' },
                    { skor: 4, text: 'Guru bermitra dengan murid, guru bermitra dengan orang tua, murid bermitra dengan murid, dan murid bermitra dengan dunia luar dalam pembelajaran' }
                ]
            },
            {
                id: 'I',
                title: 'I. Pemanfaatan Digital',
                options: [
                    { skor: 1, text: 'Guru tidak memanfaatkan digital dalam pembelajaran' },
                    { skor: 2, text: 'Guru memanfaatkan digital yang sudah tersedia online' },
                    { skor: 3, text: 'Guru mencipta pemanfaatan digital offline dengan kecerdasan artifisial' },
                    { skor: 4, text: 'Guru mencipta pemanfaatan digital online dengan kecerdasan artifisial' }
                ]
            },
            {
                id: 'J',
                title: 'J. Asesmen Formatif',
                options: [
                    { skor: 1, text: 'Guru tidak mengajukan soal untuk mengecek kemampuan murid' },
                    { skor: 2, text: 'Guru mengajukan soal secara lisan untuk mengecek kemampuan anak' },
                    { skor: 3, text: 'Guru mengajukan soal secara tertulis' },
                    { skor: 4, text: 'Guru mengajukan soal baik lisan ataupun tertulis dan memberikan umpan balik' }
                ]
            },
            {
                id: 'K',
                title: 'K. Asesmen Sumatif',
                options: [
                    { skor: 1, text: 'Guru tidak melakukan tes sumatif' },
                    { skor: 2, text: 'Guru melakukan tes sumatif' },
                    { skor: 3, text: 'Guru melakukan tes sumatif dan menilai' },
                    { skor: 4, text: 'Guru melakukan tes sumatif, menilai, dan memberi feedback' }
                ]
            },
            {
                id: 'L',
                title: 'L. Rubrik Pembelajaran Mendalam',
                options: [
                    { skor: 1, text: 'Guru tidak menyusun rubrik untuk mengukur ketercapaian Pembelajaran mendalam' },
                    { skor: 2, text: 'Guru menyusun rubrik untuk mengukur ketercapaian Pembelajaran mendalam namun belum representatif' },
                    { skor: 3, text: 'Guru menyusun rubrik untuk mengukur ketercapaian Pembelajaran mendalam yang representatif' },
                    { skor: 4, text: 'Guru menyusun rubrik untuk mengukur ketercapaian Pembelajaran mendalam yang representatif beserta teknik penskorannya' }
                ]
            },
            {
                id: 'M',
                title: 'M. Rubrik Kurikulum Berbasis Cinta',
                options: [
                    { skor: 1, text: 'Guru tidak menyusun rubrik untuk mengukur Kurikulum Berbasis Cinta' },
                    { skor: 2, text: 'Guru menyusun rubrik untuk mengukur Kurikulum Berbasis Cinta' },
                    { skor: 3, text: 'Guru menyusun rubrik untuk mengukur Kurikulum Berbasis Cinta yang representatif' },
                    { skor: 4, text: 'Guru menyusun rubrik untuk mengukur Kurikulum Berbasis Cinta yang representatif beserta teknik penskorannya' }
                ]
            }
        ];

        function renderInstruments() {
            const container = document.getElementById('instruments-container');
            instruments.forEach(inst => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'instrument-item';
                
                let optionsHtml = '';
                inst.options.forEach(opt => {
                    optionsHtml += `
                        <label class="radio-option">
                            <input type="radio" name="inst_${inst.id}" value="${opt.skor}" class="hidden" required>
                            <div class="custom-radio"></div>
                            <span class="text-slate-600 text-sm leading-snug"><span class="font-bold mr-2">${opt.skor}.</span> ${opt.text}</span>
                        </label>
                    `;
                });

                itemDiv.innerHTML = `
                    <h3 class="font-bold text-slate-800 text-lg">${inst.title}</h3>
                    <div class="radio-group">
                        ${optionsHtml}
                    </div>
                `;
                container.appendChild(itemDiv);
            });
        }

        function updateDay() {
            const dateVal = document.getElementById('tgl_supervisi').value;
            if (dateVal) {
                const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
                const d = new Date(dateVal);
                document.getElementById('hari').value = days[d.getDay()];
            }
        }

        function calculateScore(raw) {
            // Convert 1-4 scale to 0-100
            // 1=25, 2=50, 3=75, 4=100
            return (parseInt(raw) / 4) * 100;
        }

        function generateResult() {
            // Validation check
            let allFilled = true;
            instruments.forEach(inst => {
                if (!document.querySelector(`input[name="inst_${inst.id}"]:checked`)) {
                    allFilled = false;
                }
            });

            if (!allFilled) {
                alert('Harap isi semua skor instrumen sebelum menampilkan hasil.');
                return;
            }

            // Fill Result Header
            document.getElementById('res-madrasah').textContent = document.getElementById('madrasah').value || '-';
            document.getElementById('res-alamat').textContent = document.getElementById('alamat_madrasah').value || '-';
            document.getElementById('res-nama-guru').textContent = document.getElementById('nama_guru').value || '-';
            document.getElementById('res-mapel').textContent = document.getElementById('mapel').value || '-';
            document.getElementById('res-waktu').textContent = `${document.getElementById('hari').value}, ${document.getElementById('tgl_supervisi').value}`;
            document.getElementById('res-supervisor').textContent = document.getElementById('nama_supervisor').value || '-';
            document.getElementById('res-rekomendasi').textContent = document.getElementById('rekomendasi').value || 'Tidak ada rekomendasi.';
            
            // Signature
            document.getElementById('sig-guru').textContent = document.getElementById('nama_guru').value || 'Nama Guru';
            document.getElementById('sig-supervisor').textContent = document.getElementById('nama_supervisor').value || 'Nama Supervisor';

            // Generate Chart
            const chartDisplay = document.getElementById('chart-display');
            chartDisplay.innerHTML = '';

            instruments.forEach(inst => {
                const selectedVal = document.querySelector(`input[name="inst_${inst.id}"]:checked`).value;
                const score = calculateScore(selectedVal);
                
                const row = document.createElement('div');
                row.className = 'w-full';
                row.innerHTML = `
                    <div class="flex justify-between items-center text-xs font-bold text-slate-700 mb-1">
                        <span>${inst.title}</span>
                        <span class="text-blue-600">${score} / 100</span>
                    </div>
                    <div class="chart-bar-container">
                        <div class="chart-line" style="width: ${score}%;"></div>
                        <div class="chart-circle" style="left: ${score}%; background-color: ${getColor(score)};">
                            ${score}
                        </div>
                    </div>
                `;
                chartDisplay.appendChild(row);
            });

            // Switch views
            document.getElementById('input-form').style.display = 'none';
            document.getElementById('result-area').style.display = 'block';
            window.scrollTo(0, 0);
        }

        function getColor(score) {
            if (score <= 25) return '#ef4444'; // Red
            if (score <= 50) return '#f59e0b'; // Amber
            if (score <= 75) return '#3b82f6'; // Blue
            return '#10b981'; // Green
        }

        function backToForm() {
            document.getElementById('input-form').style.display = 'block';
            document.getElementById('result-area').style.display = 'none';
            window.scrollTo(0, 0);
        }

        // Global actions
        document.getElementById('btn-word').addEventListener('click', function() {
            const content = document.getElementById('printable-content').innerHTML;
            const guruName = document.getElementById('nama_guru').value || 'Guru';
            const filename = `Hasil_Supervisi_${guruName.replace(/\s+/g, '_')}.doc`;
            
            const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><style>body{font-family:Arial, sans-serif;} .border{border:1px solid #ccc; padding:10px;} .font-bold{font-weight:bold;} .text-center{text-align:center;} .uppercase{text-transform:uppercase;}</style></head><body>";
            const footer = "</body></html>";
            const sourceHTML = header + content + footer;
            
            const blob = new Blob(['\ufeff', sourceHTML], {
                type: 'application/msword'
            });
            
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            URL.revokeObjectURL(url);
        });

        document.getElementById('btn-print').addEventListener('click', function() {
            window.print();
        });

        document.getElementById('btn-back').addEventListener('click', function() {
            document.getElementById('input-form').style.display = 'block';
            document.getElementById('result-area').style.display = 'none';
            window.scrollTo(0, 0);
        });

        // Initialize
        renderInstruments();
    </script>
</body>
</html>