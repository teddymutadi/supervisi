<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Supervisi Akademik - Modern UI</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        .radio-custom:checked + label {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
            transform: scale(1.02);
        }
        .recommendation-area {
            height: 3cm;
            resize: none;
        }
        /* Lollipop Chart Styles */
        .chart-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .lollipop-row {
            display: flex;
            align-items: center;
            height: 40px;
        }
        .lollipop-label {
            width: 150px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
        }
        .lollipop-line-bg {
            flex-grow: 1;
            height: 4px;
            background: #e5e7eb;
            position: relative;
            border-radius: 2px;
        }
        .lollipop-line-fill {
            height: 100%;
            background: #4f46e5;
            position: absolute;
            left: 0;
            top: 0;
            border-radius: 2px;
            transition: width 1s ease-out;
        }
        .lollipop-head {
            width: 24px;
            height: 24px;
            background: #4f46e5;
            border: 3px solid #fff;
            border-radius: 50%;
            position: absolute;
            right: -12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .lollipop-score {
            position: absolute;
            top: -25px;
            right: -15px;
            font-size: 0.75rem;
            font-weight: 700;
            color: #4f46e5;
        }
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; padding: 0 !important; }
            .glass-card { 
                box-shadow: none !important; 
                border: 1px solid #eee !important; 
                backdrop-filter: none !important;
                background: white !important;
            }
            .lollipop-line-fill { print-color-adjust: exact; -webkit-print-color-adjust: exact; }
            #app-container { max-width: 100% !important; margin: 0 !important; }
        }
    </style>
</head>
<body class="py-10 px-4">

    <div id="app-container" class="max-w-5xl mx-auto space-y-8">
        <!-- Header -->
        <header class="text-center space-y-2">
            <h1 class="text-4xl font-extrabold text-indigo-900 tracking-tight">SUPERVISI AKADEMIK</h1>
            <p class="text-indigo-600 font-medium italic">Transformasi Pendidikan Melalui Pendampingan Bermutu</p>
        </header>

        <!-- Identity Form -->
        <section class="glass-card p-8">
            <h2 class="text-xl font-bold mb-6 text-gray-800 border-b pb-2 flex items-center">
                <span class="bg-indigo-600 text-white w-8 h-8 rounded-lg flex items-center justify-center mr-3 text-sm">01</span>
                Identitas Madrasah & Guru
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Tanggal Supervisi</label>
                    <input type="date" id="input-tanggal" class="w-full px-4 py-2 rounded-xl border-gray-200 border focus:ring-2 focus:ring-indigo-500 focus:outline-none bg-gray-50 transition-all">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Hari</label>
                    <input type="text" id="input-hari" readonly placeholder="Otomatis terisi..." class="w-full px-4 py-2 rounded-xl border-gray-200 border bg-gray-100 cursor-not-allowed">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Nama Guru</label>
                    <input type="text" id="input-guru" placeholder="Masukkan nama lengkap guru" class="w-full px-4 py-2 rounded-xl border-gray-200 border focus:ring-2 focus:ring-indigo-500 focus:outline-none bg-gray-50">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Nama Madrasah</label>
                    <input type="text" id="input-madrasah" placeholder="Contoh: MAN 1 Jakarta" class="w-full px-4 py-2 rounded-xl border-gray-200 border focus:ring-2 focus:ring-indigo-500 focus:outline-none bg-gray-50">
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-semibold text-gray-700 mb-1">Alamat Madrasah</label>
                    <textarea id="input-alamat" rows="2" placeholder="Masukkan alamat lengkap madrasah" class="w-full px-4 py-2 rounded-xl border-gray-200 border focus:ring-2 focus:ring-indigo-500 focus:outline-none bg-gray-50"></textarea>
                </div>
            </div>
        </section>

        <!-- Instrumentation Form -->
        <section id="instrument-container" class="space-y-6">
            <h2 class="text-xl font-bold text-gray-800 border-b pb-2 flex items-center glass-card p-6 !rounded-b-none mb-0">
                <span class="bg-indigo-600 text-white w-8 h-8 rounded-lg flex items-center justify-center mr-3 text-sm">02</span>
                Instrumen Supervisi Akademik
            </h2>
            <!-- Instruments will be injected here via JS -->
        </section>

        <!-- Recommendation Section -->
        <section class="glass-card p-8">
            <h2 class="text-xl font-bold mb-4 text-gray-800 flex items-center">
                <span class="bg-indigo-600 text-white w-8 h-8 rounded-lg flex items-center justify-center mr-3 text-sm">03</span>
                Rekomendasi Supervisor
            </h2>
            <textarea id="input-rekomendasi" class="recommendation-area w-full p-4 rounded-xl border-gray-200 border focus:ring-2 focus:ring-indigo-500 focus:outline-none bg-gray-50" placeholder="Tuliskan saran dan rekomendasi untuk guru yang disupervisi..."></textarea>
        </section>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center py-6 no-print">
            <button onclick="generateResult()" class="px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl shadow-lg transition-all transform hover:-translate-y-1">
                TAMPILKAN HASIL
            </button>
            <button onclick="downloadWord()" class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg transition-all transform hover:-translate-y-1">
                UNDUH WORD (.doc)
            </button>
            <button onclick="window.print()" class="px-8 py-3 bg-gray-700 hover:bg-gray-800 text-white font-bold rounded-xl shadow-lg transition-all transform hover:-translate-y-1">
                CETAK / PRINT
            </button>
        </div>

        <!-- Result Visuals (Hidden by default) -->
        <div id="result-section" class="hidden glass-card p-8 space-y-8 mt-8 border-2 border-indigo-100 animate-fade-in">
            <div class="text-center border-b pb-6">
                <h3 class="text-2xl font-bold text-indigo-900">Hasil Supervisi Akademik</h3>
                <p id="result-summary-text" class="text-gray-600 mt-2 italic font-medium"></p>
            </div>

            <div id="chart-area" class="chart-container py-4">
                <!-- Lollipop chart injected here -->
            </div>

            <!-- PDF Footer/Signature Area -->
            <div id="pdf-footer" class="grid grid-cols-2 gap-20 pt-16 text-center">
                <div class="space-y-24">
                    <p class="font-bold border-b pb-1 inline-block">Guru yang Disupervisi</p>
                    <p id="display-guru" class="font-bold">( _______________________ )</p>
                </div>
                <div class="space-y-24">
                    <p class="font-bold border-b pb-1 inline-block">Supervisor</p>
                    <p class="font-bold">( _______________________ )</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const instruments = [
            { id: 'A', title: 'Asesmen Awal', criteria: [
                'Guru tidak tidak mengajukan pertanyaan untuk mengetahui kemampuan awal murid',
                'Guru mengajukan pertanyaan untuk mengetahui kemampuan awal murid terkait dengan materi yang akan diajarkan',
                'Guru mengajukan pertanyaan untuk mengetahui kemampuan awal murid terkait dengan materi yang akan diajarkan namun tidak mengecek gaya belajar dan minat murid',
                'Guru mengajukan pertanyaan untuk mengetahui kemampuan awal murid terkait dengan materi yang akan diajarkan dan mengecek gaya belajar dan minat murid'
            ]},
            { id: 'B', title: 'Tujuan Pembelajaran', criteria: [
                'Guru tidak mengerti kalau TP diturunkan dari CP',
                'Guru mengerti kalau TP diturunkan dari CP',
                'Guru mengerti kalau TP diturunkan dari CP tapi tidak mengerti formulasi TP terdiri dari kompetensi dan kontent',
                'Guru mengerti kalau TP diturunkan dari CP dan mengerti juga formulasi TP terdiri dari kompetensi dan kontent'
            ]},
            { id: 'C', title: 'Indikator Keberhasilan', criteria: [
                'Guru tidak menyusun indikator keberhasilan',
                'Guru menyusun indikator keberhasilan tidak sesuai kompetensi',
                'Guru menyusun indikator keberhasian tidak sesuai konten',
                'Guru menyusun indikator keberhasilan komprehensif, kompetensi sesuai, dan konten sesuai'
            ]},
            { id: 'D', title: 'Pembelajaran Mendalam', criteria: [
                'Guru tidak menentukan Dimensi Profil Lulusan',
                'Guru menentukan Dimensi Profil Lulusan namun tidak relevan dengan Tujuan Pembelajaran',
                'Guru menentukan Dimensi Profil Lulusan yang relevan dengan Tujuan Pembelajaran',
                'Guru menentukan Dimensi Profil Lulusan yang relevan dengan Tujuan Pembelajaran dan menunjukkan evidence atau kegiatan yang terkait'
            ]},
            { id: 'E', title: 'Menginsersikan Kurikulum Berbasis Cinta', criteria: [
                'Guru tidak menentukan topik Panca Cinta',
                'Guru menentukan topik Panca Cinta namun tidak relevan dengan Tujuan Pembelajaran',
                'Guru menentukan topik Panca Cinta yang relevan dengan Tujuan Pembelajaran',
                'Guru menentukan topik Panca Cinta yang relevan dengan Tujuan Pembelajaran dan sekaligus materi kurikulumnya di Dirjen Pendis 6077'
            ]},
            { id: 'F', title: 'Praktik Pedagogik', criteria: [
                'Guru tidak menentukan model, strategi, metode pembelajaran',
                'Guru menentukan model, strategi, metode pembelajaran lama',
                'Guru menentukan model, strategi, metode pembelajaran yang baru',
                'Guru melakukan fusi model, strategi, metode pembelajaran yang lama dan baru'
            ]},
            { id: 'G', title: 'Lingkungan Pembelajaran', criteria: [
                'Guru menggunakan lingkungan fisik',
                'Guru menggunakan lingkungan fisik dan virtual',
                'Guru menggunakan lingkungan fisik, virtual, dan budaya belajar',
                'Guru menggunakan lingkungan fisik, virtual, budaya belajar, dan hubungan'
            ]},
            { id: 'H', title: 'Kemitraan Pembelajaran', criteria: [
                'Guru tidak bermitra dengan murid dalam pembelajaran',
                'Guru bermitra dengan murid, orang tua dalam pembelajaran',
                'Guru bermitra dengan murid, guru bermitra dengan orang tua, murid bermitra dengan murid dalam pembelajaran',
                'Guru bermitra dengan murid, guru bermitra dengan orang tua, murid bermitra dengan murid, dan murid bermitra dengan dunia luar dalam pembelajaran'
            ]},
            { id: 'I', title: 'Pemanfaatan Digital', criteria: [
                'Guru tidak memanfaatkan digital dalam pembelajaran',
                'Guru memanfaatkan digital yang sudah tersedia online',
                'Guru mencipta pemanfaatan digital offline dengan kecerdasan artifisial',
                'Guru mencipta pemanfaatan digital online dengan kecerdasan artifisial'
            ]},
            { id: 'J', title: 'Asesmen Formatif', criteria: [
                'Guru tidak mengajukan soal untuk mengecek kemampuan murid',
                'Guru mengajukan soal secara lisan untuk mengecek kemampuan anak',
                'Guru mengajukan soal secara tertulis',
                'Guru mengajukan soal baik lisan ataupun tertulis dan memberikan umpan balik'
            ]},
            { id: 'K', title: 'Asesmen Sumatif', criteria: [
                'Guru tidak melakukan tes sumatif',
                'Guru melakukan tes sumatif',
                'Guru melakukan tes sumatif dan menilai',
                'Guru melakukan tes sumatif, menilai, dan memberi feedback'
            ]},
            { id: 'L', title: 'Rubrik Pembelajaran Mendalam', criteria: [
                'Guru tidak menyusun rubrik untuk mengukur ketercapaian Pembelajaran mendalam',
                'Guru menyusun rubrik untuk mengukur ketercapaian Pembelajaran mendalam namun belum representatif',
                'Guru menyusun rubrik untuk mengukur ketercapaian Pembelajaran mendalam yang representatif',
                'Guru menyusun rubrik untuk mengukur ketercapaian Pembelajaran mendalam yang representatif besera teknik penskorannya'
            ]},
            { id: 'M', title: 'Rubrik Kurikulum Berbasis Cinta', criteria: [
                'Guru tidak menyusun rubrik untuk mengukur Kurikulum Berbasis Cinta',
                'Guru menyusun rubrik untuk mengukur Kurikulum Berbasis Cinta',
                'Guru menyusun rubrik untuk mengukur Kurikulum Berbasis Cinta yang representatif',
                'Guru menyusun rubrik untuk mengukur Kurikulum Berbasis Cinta yang representatif besera teknik penskorannya'
            ]}
        ];

        // Render Instruments
        const container = document.getElementById('instrument-container');
        instruments.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'glass-card p-6 transition-all hover:ring-1 hover:ring-indigo-300';
            card.innerHTML = `
                <div class="flex items-start mb-4">
                    <span class="text-indigo-600 font-bold mr-3 text-lg">${item.id}.</span>
                    <h3 class="font-bold text-gray-800 text-lg">${item.title}</h3>
                </div>
                <div class="grid grid-cols-1 gap-3">
                    ${item.criteria.map((text, i) => `
                        <div class="flex items-center">
                            <input type="radio" id="score-${item.id}-${i+1}" name="score-${item.id}" value="${i+1}" class="hidden radio-custom peer">
                            <label for="score-${item.id}-${i+1}" class="flex-grow flex items-center p-3 rounded-xl border border-gray-100 bg-gray-50 cursor-pointer transition-all hover:bg-indigo-50 peer-checked:bg-indigo-600 peer-checked:text-white peer-checked:border-indigo-600">
                                <span class="w-6 h-6 rounded-full border-2 border-current flex items-center justify-center mr-3 text-xs font-bold">${i+1}</span>
                                <span class="text-sm leading-relaxed">${text}</span>
                            </label>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(card);
        });

        // Auto Day Calculation
        document.getElementById('input-tanggal').addEventListener('change', function() {
            const date = new Date(this.value);
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            document.getElementById('input-hari').value = days[date.getDay()] || '';
        });

        function calculateScores() {
            const scores = {};
            instruments.forEach(item => {
                const selected = document.querySelector(`input[name="score-${item.id}"]:checked`);
                scores[item.id] = selected ? (parseInt(selected.value) * 25) : 0;
            });
            return scores;
        }

        function generateResult() {
            const scores = calculateScores();
            const resultSection = document.getElementById('result-section');
            const chartArea = document.getElementById('chart-area');
            const guruName = document.getElementById('input-guru').value || '...';
            
            resultSection.classList.remove('hidden');
            document.getElementById('display-guru').innerText = `( ${guruName} )`;
            document.getElementById('result-summary-text').innerText = `Laporan hasil pengamatan performa akademik Sdr/i ${guruName}`;

            chartArea.innerHTML = '';
            instruments.forEach(item => {
                const score = scores[item.id];
                const row = document.createElement('div');
                row.className = 'lollipop-row';
                row.innerHTML = `
                    <div class="lollipop-label">${item.id}. ${item.title}</div>
                    <div class="lollipop-line-bg">
                        <div class="lollipop-line-fill" style="width: ${score}%">
                            <div class="lollipop-head">
                                <span class="lollipop-score">${score}</span>
                            </div>
                        </div>
                    </div>
                `;
                chartArea.appendChild(row);
            });

            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        function downloadPDF() {
            const resultSection = document.getElementById('result-section');
            if (resultSection.classList.contains('hidden')) {
                generateResult();
            }

            // Use a specific element for PDF to avoid capture issues with buttons
            const element = document.getElementById('app-container');
            const guruName = document.getElementById('input-guru').value || 'Guru';
            
            const opt = {
                margin:       [10, 10],
                filename:     `Supervisi_Akademik_${guruName}.pdf`,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] }
            };

            // Temporary hide buttons for cleaner capture
            const buttons = document.querySelector('.no-print');
            if(buttons) buttons.style.display = 'none';

            html2pdf().set(opt).from(element).save().then(() => {
                if(buttons) buttons.style.display = 'flex';
            });
        }

        function downloadWord() {
            const guruName = document.getElementById('input-guru').value || '...';
            const madrasah = document.getElementById('input-madrasah').value || '...';
            const tanggal = document.getElementById('input-tanggal').value || '...';
            const hari = document.getElementById('input-hari').value || '...';
            const alamat = document.getElementById('input-alamat').value || '...';
            const rekomendasi = document.getElementById('input-rekomendasi').value || '-';
            
            const scores = calculateScores();
            
            let tableRows = '';
            instruments.forEach(item => {
                tableRows += `
                    <tr>
                        <td style="border: 1px solid black; padding: 5px;">${item.id}</td>
                        <td style="border: 1px solid black; padding: 5px;">${item.title}</td>
                        <td style="border: 1px solid black; padding: 5px; text-align: center;">${scores[item.id]}</td>
                    </tr>
                `;
            });

            const content = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
                <head><meta charset='utf-8'><title>Laporan Supervisi</title>
                <style>
                    body { font-family: 'Arial', sans-serif; }
                    table { border-collapse: collapse; width: 100%; }
                    .header { text-align: center; font-weight: bold; font-size: 16pt; margin-bottom: 20px; }
                    .section-title { font-weight: bold; margin-top: 15px; background: #eee; padding: 5px; }
                </style>
                </head>
                <body>
                    <div class="header">LAPORAN HASIL SUPERVISI AKADEMIK</div>
                    
                    <div class="section-title">I. IDENTITAS</div>
                    <p><b>Hari / Tanggal:</b> ${hari}, ${tanggal}</p>
                    <p><b>Nama Guru:</b> ${guruName}</p>
                    <p><b>Madrasah:</b> ${madrasah}</p>
                    <p><b>Alamat:</b> ${alamat}</p>

                    <div class="section-title">II. HASIL PENILAIAN</div>
                    <table>
                        <thead>
                            <tr style="background-color: #f2f2f2;">
                                <th style="border: 1px solid black; padding: 5px;">No</th>
                                <th style="border: 1px solid black; padding: 5px;">Aspek Supervisi</th>
                                <th style="border: 1px solid black; padding: 5px;">Skor (0-100)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableRows}
                        </tbody>
                    </table>

                    <div class="section-title">III. REKOMENDASI</div>
                    <p>${rekomendasi}</p>

                    <br><br>
                    <table style="width: 100%; border: none;">
                        <tr>
                            <td style="width: 50%; text-align: center; border: none;">
                                <p>Guru yang Disupervisi</p>
                                <br><br><br>
                                <p><b>( ${guruName} )</b></p>
                            </td>
                            <td style="width: 50%; text-align: center; border: none;">
                                <p>Supervisor</p>
                                <br><br><br>
                                <p><b>( _______________________ )</b></p>
                            </td>
                        </tr>
                    </table>
                </body>
                </html>
            `;

            const fileName = `Supervisi_${guruName.replace(/\s+/g, '_')}.doc`;
            const blob = new Blob(['\ufeff', content], {
                type: 'application/msword'
            });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            link.click();
            URL.revokeObjectURL(link.href);
        }
    </script>
</body>
</html>